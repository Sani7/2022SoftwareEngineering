#include <stdio.h>
#include <check.h>
#include <stdlib.h>
#include <string.h>

#include "test.h"

//helper function to compare array elements
char compareArray(int a[],int b[],int size)	{
	int i;
	for(i=0;i<size;i++){
		if(a[i]!=b[i])
			return failed;
	}
	return succes;
}

START_TEST (test_readSetting)
{
	char input[] = "SSID=tso\nPSWD=99926137393993312405\nIP=192.168.178.89\nPOST=/post-esp-data.php\nGET=/get-test-data.php\nAPIKey=uHKSk7uB29Up3\n";
    char output[20];

    ck_assert_int_eq(readSetting(input, sizeof(input), "SSID", output, sizeof(output)), succes);
    ck_assert_int_eq(strcmp(output, "tso"), 0);

    ck_assert_int_eq(readSetting(input, sizeof(input), "Test", output, sizeof(output)), failed);

    ck_assert_int_eq(readSetting(input, sizeof(input), "POST", output, sizeof(output)), succes);
    ck_assert_int_eq(strcmp(output, "/post-esp-data.php"), 0);
}
END_TEST


START_TEST (test_convertToInt)
{
    char    input0[] = "100,99,99,98,98,95,75,76,79,81,83,83,83,84,86,85,72,69,68,45,14,15,17,19,22,25,28,30,32,34,,40,43,45,48,50,52,55,57,59,61,63,65,67,69,71,72,74,75,75,77,77,78,77,63,60,45,47,50,51,53,55,58,59,62,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,96,97,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,95,88,87,88,89,88,87,88,89,90,91,92,94,96,95,93,94,96,97,98,99,99,99,99,99,99,100,99,99,99,99,99,99,99,99,94,88,89,91,93,95,97,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,98,94,95,97,98,93,95,96,98,99,99,98,97,99,99,99,99,99,99,99,99,99,99,98,99,99,99,99,99,99,99,99,98,99,99,99,99,99,99,99,99,99,99,99,98,74,72,71,60,61,62,64,66,68,70,73,75,76,78,79,77,79,81,82,84,86,88,89,91,93,94,96,97,98,99,99,99,99,99,99,99,99,100,99,99,99,100,100,99,99,99,99,99,99,99,99,99,99,99,99,99,99,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,100,99,99,99,99,99,99,100,";
    int     output0[] = {100,99,99,98,98,95,75,76,79,81,83,83,83,84,86,85,72,69,68,45,14,15,17,19,22,25,28,30,32,34,ymax + 1,40,43,45,48,50,52,55,57,59,61,63,65,67,69,71,72,74,75,75,77,77,78,77,63,60,45,47,50,51,53,55,58,59,62,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,96,97,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,95,88,87,88,89,88,87,88,89,90,91,92,94,96,95,93,94,96,97,98,99,99,99,99,99,99,100,99,99,99,99,99,99,99,99,94,88,89,91,93,95,97,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,98,94,95,97,98,93,95,96,98,99,99,98,97,99,99,99,99,99,99,99,99,99,99,98,99,99,99,99,99,99,99,99,98,99,99,99,99,99,99,99,99,99,99,99,98,74,72,71,60,61,62,64,66,68,70,73,75,76,78,79,77,79,81,82,84,86,88,89,91,93,94,96,97,98,99,99,99,99,99,99,99,99,100,99,99,99,100,100,99,99,99,99,99,99,99,99,99,99,99,99,99,99,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,100,99,99,99,99,99,99,100};
    char    input1[] = "100,99,99,98,98,95,75,76,79,81,83,83,83,84,86,85,72,69,68,45,14,15,17,19,22,25,28,30,32,34,,40,43,45,48,50,52,55,57,59,61,63,65,67,69,71,72,74,75,75,77,77,78,77,63,60,45,47,50,51,53,55,58,59,62,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,96,97,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,95,88,87,88,89,88,87,88,89,90,91,92,94,96,95,93,94,96,97,98,99,99,99,99,99,99,100,99,99,99,99,99,99,99,99,94,88,89,91,93,95,97,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,98,94,95,97,98,93,95,96,98,99,99,98,97,99,99,99,99,99,99,99,99,99,99,98,99,99,99,99,99,99,99,99,98,99,99,99,99,99,99,99,99,99,99,99,98,74,72,71,60,61,62,64,66,68,70,73,75,76,78,79,77,79,81,82,84,86,88,89,91,93,94,96,97,98,99,99,99,99,99,99,99,99,100,99,99,99,100,100,99,99,99,99,99,99,99,99,99,99,99,99,99,99,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,100,99,99,99,99,99,99,100,99,";
    int     output[290];

    ck_assert_int_eq(convertToInt(input0, output, sizeof(output) / sizeof(int)), succes);
    ck_assert_int_eq(compareArray(output, output0, sizeof(output0) / sizeof(int)), succes);
    ck_assert_int_eq(convertToInt(input1, output, sizeof(output) / sizeof(int)), failed);


}
END_TEST


Suite* GLCD_test_suite(void)
{
    Suite *s;
    TCase *tc_core;
    s = suite_create("GLCD_test_suite");
    tc_core = tcase_create("Core");
    tcase_add_test(tc_core, test_readSetting);
    tcase_add_test(tc_core, test_convertToInt);
    suite_add_tcase(s, tc_core);
    return s;
}

int main(int argc, char ** argv) 
{
    int number_failed;
    Suite *s;
    SRunner *sr;

    s = GLCD_test_suite();
    sr = srunner_create(s);

    //srunner_set_fork_status(sr, CK_NOFORK);
    srunner_run_all(sr, CK_NORMAL);
    number_failed = srunner_ntests_failed(sr);
    srunner_free(sr);
    return (number_failed == 0) ? EXIT_SUCCESS : EXIT_FAILURE;
} 

